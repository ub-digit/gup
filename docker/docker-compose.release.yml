version: '3.7'
services:
  frontend:
    image: docker.ub.gu.se/gup-frontend:${GIT_REVISION}
    environment:
      - GUP_SERVICE_HOSTNAME=${BACKEND_HOSTNAME}
    ports:
      # Port differs in release image for ember
      # TODO: Change so nginx listens at 4200 instead to we don't need this?
      - ${GUP_FRONTEND_PORT}:8080
  backend:
    image: docker.ub.gu.se/gup-backend:${GIT_REVISION}
    envionment:
      - GUP_HOSTNAME=${BACKEND_HOSTNAME}
    volumes:
      - ./gup-uploads:/opt/gup-uploads
  db:
    image: docker.ub.gu.se/gup-postgres:${GIT_REVISION}
    volumes:
      - ./postgres-data:/var/lib/postgresql/data
  solr:
    volumes:
      - ./gup-guresearch:/opt/solr/server/solr/mycores/gup-guresearch/data
      - ./gup-journals:/opt/solr/server/solr/mycores/gup-journals/data
      - ./gup-people:/opt/solr/server/solr/mycores/gup-people/data
      - ./gup-publications:/opt/solr/server/solr/mycores/gup-publications/data
